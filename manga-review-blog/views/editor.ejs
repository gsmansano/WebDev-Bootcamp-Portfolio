<%- include("partials/header.ejs") %>

<div class="container">
    <div class="editor-container">
        <aside class="editor-sidebar">
            <img src="<%= isEditing ? manga.cover_url : manga.images.jpg.large_image_url %>" 
                 alt="<%= isEditing ? manga.title_en : manga.title %>" 
                 class="editor-manga-img" />
            <div class="manga-info">
                <h1><%= isEditing ? manga.title_en : manga.title %></h1>
                <p class="author-label">By <%= isEditing ? manga.author : (manga.authors[0] ? manga.authors[0].name : 'Unknown') %></p>
            </div>
        </aside>

        <main class="editor-main">
            <form action="<%= isEditing ? '/update-review/' + manga.id : '/save-review' %>" method="POST" class="review-form">
                
                <% if (!isEditing) { %>
                    <input type="hidden" name="mal_id" value="<%= manga.mal_id %>" />
                    <input type="hidden" name="title" value="<%= manga.title %>" />
                    <input type="hidden" name="title_jp" value="<%= manga.title_japanese %>" />
                    <input type="hidden" name="image_url" value="<%= manga.images.jpg.large_image_url %>" />
                    <input type="hidden" name="author" value="<%= manga.authors[0] ? manga.authors[0].name : 'Unknown' %>" />
                    <input type="hidden" name="genre" value="<%= manga.genres.map(g => g.name).join(', ') %>" />
                <% } %>

                <div class="form-group">
                    <label for="rating">Rating (1-10)</label>
                    <input type="number" name="rating" id="rating" min="1" max="10" step="0.1" 
                           value="<%= isEditing ? manga.rating : '' %>" placeholder="e.g. 9.5" required />
                </div>

                <div class="form-group">
                    <label for="summary">Short Hook</label>
                    <textarea name="summary" id="summary" rows="2" 
                              placeholder="The one-sentence hook that captures the vibe..." required><%= isEditing ? manga.summary : '' %></textarea>
                </div>

                <div class="form-group">
                    <label for="full_review">Full Review</label>
                    <textarea name="full_review" id="full_review" rows="12" 
                              placeholder="Dive deep into the story, characters, and art..." required><%= isEditing ? manga.full_review : '' %></textarea>
                </div>

                <div class="editor-actions">
                    <button type="submit" class="btn-publish">
                        <%= isEditing ? 'Update Review' : 'Publish Review' %>
                    </button>
                    <a href="<%= isEditing ? '/review/' + manga.id : '/search' %>" class="btn-cancel">Cancel</a>
                </div>
            </form>
        </main>
    </div>
</div>

<%- include("partials/footer.ejs") %>